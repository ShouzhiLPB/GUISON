# 音效参数定义

## 旋钮映射

| 旋钮 | 控制参数 | 范围 | 说明 |
|------|----------|------|------|
| Knob 1 | `distortion_gain` | 0.0 - 1.0 | 失真增益（0=干净，1=重失真） |
| Knob 2 | `effect_mix` | 0.0 - 1.0 | 效果混合（0=原声，1=全效果） |

## DSP参数表

### 1. Distortion（失真）

| 参数名 | 类型 | 范围 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `distortion_gain` | float | 0.0 - 1.0 | 0.5 | 失真强度 |
| `distortion_tone` | float | 0.0 - 1.0 | 0.5 | 音色（低频/高频平衡） |

### 2. Delay（延迟）

| 参数名 | 类型 | 范围 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `delay_time` | float | 0.0 - 1.0 | 0.3 | 延迟时间（映射到100-1000ms） |
| `delay_feedback` | float | 0.0 - 1.0 | 0.4 | 反馈量（回声次数） |
| `delay_mix` | float | 0.0 - 1.0 | 0.3 | 干湿比 |

### 3. Reverb（混响）

| 参数名 | 类型 | 范围 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `reverb_size` | float | 0.0 - 1.0 | 0.6 | 房间大小 |
| `reverb_damping` | float | 0.0 - 1.0 | 0.5 | 阻尼（高频衰减） |
| `reverb_mix` | float | 0.0 - 1.0 | 0.25 | 干湿比 |

## 可视化映射

### 参数 → 视觉元素

| 音效参数 | 视觉效果 | 实现方式 |
|----------|----------|----------|
| `distortion_gain` | 图形扭曲程度 | 顶点偏移量 |
| `distortion_gain` | 颜色饱和度 | RGB饱和度系数 |
| `delay_time` | 拖尾长度 | 粒子生命周期 |
| `delay_feedback` | 残影数量 | Alpha混合层数 |
| `reverb_size` | 背景光晕半径 | 高斯模糊半径 |
| `reverb_damping` | 色温 | 色相偏移 |

## 参数更新频率

- **旋钮采样**：100Hz（10ms间隔）
- **DSP参数更新**：实时（每个音频块）
- **串口发送**：30Hz（30ms间隔，降低通信开销）
- **可视化刷新**：60Hz（16.6ms间隔）

## 参数平滑

为避免突变产生爆音，所有参数变化使用一阶低通滤波：

```
平滑时间常数: τ = 50ms
更新公式: param_smooth = param_smooth * 0.95 + param_new * 0.05
```
